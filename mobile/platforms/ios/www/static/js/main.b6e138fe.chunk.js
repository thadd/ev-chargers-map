(this["webpackJsonpev-chargers"]=this["webpackJsonpev-chargers"]||[]).push([[0],{196:function(e,t,a){},197:function(e){e.exports=JSON.parse('{"clientId":"ev-chargers-map","namespace":"mobile-developer-console","services":[{"config":{"ios":{"variantId":"7aa1a115-cd80-4579-bc9f-35dc1b952b10","variantSecret":"4fe3e42c-039f-442d-a0f5-ed11caf03ad6"}},"id":"68b70ac3-f52c-11e9-afb6-12f216a753ee","name":"push","type":"push","url":"https://unifiedpush-unifiedpush-proxy-mobile-unifiedpush.apps.thadd-8469.open.redhat.com"},{"config":{"auth-server-url":"https://sso-user-sso.apps.thadd-8469.open.redhat.com/auth","confidential-port":0,"public-client":true,"realm":"ev-chargers-map-realm","resource":"ev-chargers-map-client","ssl-required":"external"},"id":"a999ff9f-ef90-11e9-bce8-12f216a753ee","name":"keycloak","type":"keycloak","url":"https://sso-user-sso.apps.thadd-8469.open.redhat.com/auth"},{"config":{"websocketUrl":"ws://ev-chargers-backend-ev-chargers-map.apps.thadd-8469.open.redhat.com/graphql"},"id":"30488353-f01f-11e9-bce8-12f216a753ee","name":"sync-app","type":"sync-app","url":"http://ev-chargers-backend-ev-chargers-map.apps.thadd-8469.open.redhat.com/graphql"},{"id":"46f1a827-f52e-11e9-afb6-12f216a753ee","name":"security","type":"security","url":"https://route-mobile-security-service.apps.thadd-8469.open.redhat.com"}]}')},198:function(e,t,a){"use strict";a.r(t),a.d(t,"initialize",(function(){return i}));var n=a(89);function i(e){setTimeout((function(){document.addEventListener("deviceready",(function(){console.log("device is ready"),window.open=window.cordova.InAppBrowser.open,console.log("registering push",e.getConfigByType("push")),new n.PushRegistration(e).register({timeout:6e4}).then((function(){console.log("push registration complete")})).catch((function(e){console.error("push reg failed",e)}))}),!1),console.log("initialized cordova")}),1e4)}},208:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a.n(n),r=a(36),o=a.n(r),c=(a(98),a(24)),s=a(37),l=a(38),u=a(91),h=a(81),d=a(16),m=a(92),f=a(45),p=a(9),g=a.n(p),v=a(82),b=a(46),y=a.n(b),E=a(47),k=a.n(E),S=a(83),N=a(87),C=a(30),w=a(212),O=a(213),A=a(211),L=a(214),j=(a(192),a(193),a(194),a(195),a(196),a(88));function z(){var e=Object(f.a)(["\n  mutation SetFavorite($id:ID!, $isFavorite:Boolean!) {\n    setFavorite(id:$id, isFavorite:$isFavorite) {\n      id\n    }\n  }\n"]);return z=function(){return e},e}function F(){var e=Object(f.a)(["\n  query Favorites {\n    favorites {\n      id\n    }\n  }\n"]);return F=function(){return e},e}function x(){var e=Object(f.a)(["\n  query ChargersNear($latitude:Float!, $longitude:Float!) {\n    chargersNear(location:{\n      latitude:$latitude\n      longitude:$longitude\n    }) {\n      id\n      station_name\n      latitude\n      longitude\n      access_days_time\n      ev_network\n    }\n  }\n"]);return x=function(){return e},e}var M=a(197),B=Object(j.init)(M);window.cordova&&a(198).initialize(B.config);var q=new N.Auth(B.config),P=k()(x()),_=k()(F()),U=k()(z()),$=g.a.AwesomeMarkers.icon({icon:"bolt",markerColor:"red",prefix:"fa"}),D=new v.OpenStreetMapProvider,I=function(e){return i.a.createElement("div",{className:"station-popup"},e.isAuthenticated&&i.a.createElement("div",{className:"favorite pull-left",onClick:function(){return e.toggleFavorite(e.id)}},e.isFavorite?i.a.createElement("div",{className:"fa-stack"},i.a.createElement("i",{className:"fas fa-star fa-stack-2x"}),i.a.createElement("i",{className:"far fa-star fa-stack-2x"})):i.a.createElement("div",{className:"fa-stack"},i.a.createElement("i",{className:"far fa-star fa-stack-2x"}))),i.a.createElement("strong",null,e.station_name),i.a.createElement("br",null),i.a.createElement("em",null,e.access_days_time),i.a.createElement("br",null),e.ev_network)},T=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={map:null,mapCenter:null,mapBounds:null,location:"",searchedLocation:[],chargers:[],favoriteChargers:[],isAuthLoading:!0,isAuthenticated:!1},a.initializeDataService=a.initializeDataService.bind(Object(d.a)(a)),a.initializeMap=a.initializeMap.bind(Object(d.a)(a)),a.handleLocationUpdate=a.handleLocationUpdate.bind(Object(d.a)(a)),a.handleSearch=a.handleSearch.bind(Object(d.a)(a)),a.handleLogin=a.handleLogin.bind(Object(d.a)(a)),a.handleLogout=a.handleLogout.bind(Object(d.a)(a)),a.handleToggleFavorites=a.handleToggleFavorites.bind(Object(d.a)(a)),a.loginComplete=a.loginComplete.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;q.init({}).then((function(){return q.isAuthenticated()?e.loginComplete():C.fromCallback((function(t){return e.setState({userProfile:null,isAuthLoading:!1,isAuthenticated:!1},t)})).then(e.initializeDataService)})).catch((function(e){return console.error("initialization error",e)}))}},{key:"initializeMap",value:function(){var e=this;D.search({query:"California"}).then((function(t){e.setState({mapCenter:[Number(t[0].raw.lat),Number(t[0].raw.lon)],mapBounds:t[0].bounds})})).then((function(){var t=localStorage.getItem("savedSearch");t&&(localStorage.removeItem("savedSearch"),e.setState({location:JSON.parse(t)},(function(){e.handleSearch(new Event("dummy"))})))}))}},{key:"handleLocationUpdate",value:function(e){this.setState({location:e.target.value})}},{key:"handleSearch",value:function(e){var t=this;e.preventDefault(),D.search({query:this.state.location}).then((function(e){e.length>=1&&t.setState({searchedLocation:e},(function(){t.setState({mapBounds:e[0].bounds});var a={latitude:Number(e[0].raw.lat),longitude:Number(e[0].raw.lon)};t.state.dataClient.query({query:P,variables:a,fetchPolicy:"network-only"}).then((function(e){var a=e.data.chargersNear,n=[[Math.min.apply(Math,Object(c.a)(a.map((function(e){return e.latitude})))),Math.min.apply(Math,Object(c.a)(a.map((function(e){return e.longitude}))))],[Math.max.apply(Math,Object(c.a)(a.map((function(e){return e.latitude})))),Math.max.apply(Math,Object(c.a)(a.map((function(e){return e.longitude}))))]];t.setState({chargers:a,mapBounds:n})}))}))}))}},{key:"handleLogin",value:function(e){this.setState({isAuthLoading:!0}),this.state.location&&this.state.location.length>0&&localStorage.setItem("savedSearch",JSON.stringify(this.state.location)),q.login().then(this.loginComplete)}},{key:"handleLogout",value:function(e){var t=this;this.setState({isAuthLoading:!0}),q.logout().then((function(){t.setState({isAuthenticated:!1,isAuthLoading:!1})}),(function(e){t.setState({isAuthLoading:!1}),console.error("authService error",e)})).catch((function(e){t.setState({isAuthLoading:!1}),console.error("authService error",e)}))}},{key:"handleToggleFavorites",value:function(e){var t=this;return C.fromCallback((function(a){var n;n=t.state.favoriteChargers.includes(e)?y.a.without(t.state.favoriteChargers,e):[].concat(Object(c.a)(t.state.favoriteChargers),[e]),t.setState({favoriteChargers:n},a)})).then((function(){return t.state.dataClient.mutate({mutation:U,variables:{id:e,isFavorite:t.state.favoriteChargers.includes(e)},fetchPolicy:"no-cache"})})).catch((function(e){return console.error("mutation",e)}))}},{key:"initializeDataService",value:function(){var e=this,t=y.a.find(B.config.configurations,{type:"sync-app"}),a={httpUrl:"".concat(t.url).concat(q.isAuthenticated()?"-auth":""),wsUrl:"".concat(t.config.websocketUrl).concat(q.isAuthenticated()?"-auth":"")};if(q.isAuthenticated()){var n=q.extract().token;a.authContextProvider=function(){return{headers:{Authorization:"Bearer ".concat(n)},token:n}}}return new S.OfflineClient(a).init().then((function(t){return C.fromCallback((function(a){return e.setState({dataClient:t},a)}))})).then((function(){if(q.isAuthenticated())return console.log("authenticated, fetching chargers"),e.state.dataClient.query({query:_,fetchPolicy:"network-only"}).then((function(t){var a=t.data;console.log("data",a),e.setState({favoriteChargers:y.a.map(a.favorites,"id")})}),console.error)})).catch((function(e){return console.error("data sync initialization rejection",e)}))}},{key:"loginComplete",value:function(){var e=this;return q.loadUserProfile().then((function(t){return C.fromCallback((function(a){return e.setState({isAuthenticated:q.isAuthenticated(),isAuthLoading:!1,userProfile:t},a)}))})).then(this.initializeDataService).then((function(){return console.log("initialization complete")})).catch((function(t){e.setState({isAuthLoading:!1}),console.error("authService error",t)}))}},{key:"render",value:function(){var e=this,t=this.state.mapCenter?this.state.mapCenter:[36.7014631,-118.7559974],a={zoom:this.state.mapBounds?null:13,bounds:this.state.mapBounds};return i.a.createElement("div",{className:"root"},i.a.createElement("div",{id:"actions"},i.a.createElement("div",{className:"profile"},this.state.isAuthLoading?i.a.createElement("div",{className:"text-center"},i.a.createElement("i",{className:"fas fa-circle-notch fa-spin"})):this.state.isAuthenticated?i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,"Welcome, ",this.state.userProfile.firstName," ",this.state.userProfile.lastName,"!"),i.a.createElement("button",{className:"btn btn-secondary btn-sm pull-right",onClick:function(){return e.handleLogout()}},i.a.createElement("i",{className:"fa fa-user"})," Log out")):i.a.createElement("div",{className:"text-center"},i.a.createElement("button",{className:"btn btn-secondary btn-sm",onClick:function(){return e.handleLogin()}},i.a.createElement("i",{className:"fa fa-user"})," Log in"))),i.a.createElement("form",{onSubmit:this.handleSearch},i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"input-group"},i.a.createElement("input",{className:"form-control",type:"text",value:this.state.location,onChange:this.handleLocationUpdate}),i.a.createElement("div",{className:"input-group-append"},i.a.createElement("button",{className:"btn btn-primary",type:"submit"},i.a.createElement("i",{className:"fa fa-search"})))))),i.a.createElement("div",{className:"charger-list"},this.state.chargers.map((function(t){return i.a.createElement("div",{key:t.id,className:"card charger ".concat(e.state.favoriteChargers.includes(t.id)?"favorite":"")},i.a.createElement("div",{className:"card-body"},i.a.createElement("h5",{className:"card-title"},t.station_name),i.a.createElement("p",{className:"card-text"},t.access_days_time)))})))),this.state.dataClient&&i.a.createElement("div",{id:"map-container"},i.a.createElement("div",{id:"map"},i.a.createElement(w.a,Object.assign({id:"map",center:t},a,{whenReady:this.initializeMap}),i.a.createElement(O.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),this.state.chargers.map((function(t){return i.a.createElement(A.a,{key:t.id,position:[t.latitude,t.longitude],icon:$},i.a.createElement(L.a,null,i.a.createElement(I,Object.assign({},t,{isAuthenticated:e.state.isAuthenticated,isFavorite:e.state.favoriteChargers.includes(t.id),toggleFavorite:e.handleToggleFavorites}))))}))))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},93:function(e,t,a){e.exports=a(208)},98:function(e,t,a){}},[[93,1,2]]]);
//# sourceMappingURL=main.b6e138fe.chunk.js.map